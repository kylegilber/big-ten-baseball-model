---
title: "2025 Big Ten Baseball Standings Predictor"
author: "kylegilber"
date: "`r Sys.Date()`"
output: github_document
---

```{r, message= f, warning= f, echo= f}

### IMPORTS ###

# Add packages
library(dplyr)
library(tidyr)
library(purrr)

# Load workspace image
load("~/Github/big-ten-baseball-model/data.RData")
```

```{r, message= f, warning= f, echo= f}

### DATA TRANSFORMATION FUNCTIONS ###

# List column variables to count
cols <- list("PlayResult", "KorBB", "PitchCall")

# Define summary function ∀ pitchers
summarise_pitcher <- function(data, name) {
  
  # Generate a data frame for each column
  counts <- map(cols, ~ data %>% 
      count(Pitcher, .data[[.x]]) %>% 
      pivot_wider(names_from = .data[[.x]], values_from = n, values_fill = 0))
  
  # Count innings pitched ∀ pitchers
  innings <- data %>% 
    distinct(Pitcher, Inning, Date) %>% 
    count(Pitcher, name = "Innings")
  
  # Join data frames by pitcher
  reduce(counts, left_join, by = "Pitcher") %>% 
    left_join(innings, by = "Pitcher") %>% 
    mutate(
      
      # Fielding independent pitching (FIP)
      FIP = (13*HomeRun + 3*(Walk + HitByPitch) - 2*Strikeout)/Innings + 4.22,
      
      # # Strikeouts & walks per nine innings (K/9, BB/9)
      K9 = (Strikeout / Innings) * 9, BB9 = (Walk / Innings) * 9,
      
      # Walks & hits per inning pitched
      WHIP = (Walk + Single + Double + Triple + HomeRun) / Innings
    ) %>% 
    
    # Filter pitchers by innings pitched
    filter(Innings >= 5) %>% 
    
    # Summarize batting statistics across team
    summarise(
      Team = name,
      Pitchers = n(),
      across(
        c(FIP, K9, BB9, WHIP),
        list(
          min = ~min(.x),
          max = ~max(.x),
          median = ~median(.x),
          mean = ~mean(.x),
          mad = ~mad(.x, center = median(.x)),
          stdev = ~sd(.x)
        )
      )
    )
}

# Define summary function ∀ batters
summarise_batter <- function(data, name) {
  
  # Generate a data frame for each column
  counts <- map(cols, ~ data %>% 
      count(Batter, .data[[.x]]) %>% 
      pivot_wider(names_from = .data[[.x]], values_from = n, values_fill = 0))
  
  # Count plate attempts ∀ batters
  appearances <- data %>% 
    distinct(Batter, Inning, PAofInning, Date) %>% 
    count(Batter, name = "PA")
  
  # Join data frames by batter
  reduce(counts, left_join, by = "Batter") %>% 
    left_join(appearances, by = "Batter") %>% 
    mutate(
      
      # Weighted on-base average (wOBA)
      wOBA = (0.812 * Walk + 0.838 * HitByPitch + 0.943 * Single +
        1.271 * Double + 1.616 * Triple + 1.764 * HomeRun) / 
        (PA + Walk + Sacrifice + HitByPitch),
      
      # Strikeout & walk percentage (K%, BB%)
      KRate = Strikeout / PA, BBRate = Walk / PA,
      
      # Isolated power (ISO)
      ISO = (Double + 2*Triple + 3*HomeRun) / PA
    ) %>% 
    
    # Filter batters by plate appearances
    filter(PA >= 10) %>% 
    
    # Summarize batting statistics across team
    summarise(
      Team = name,
      Batters = n(),
      across(
        c(wOBA, KRate, BBRate, ISO),
        list(
          min = ~min(.x),
          max = ~max(.x),
          median = ~median(.x),
          mean = ~mean(.x),
          mad = ~mad(.x, center = median(.x)),
          stdev = ~sd(.x)
        )
      )
    )
}
```


